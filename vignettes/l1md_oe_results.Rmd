---
title: "l1md_oe_results"
output: html_document
date: "2022-11-17"
---

```{r load-libraries-and-data}
library(dplyr)
library(ggplot2)
library(reshape2)
library(tidyr)
library(data.table)
library(Matrix)
library(RColorBrewer)
library(dcon)
library(rtracklayer)
library(InteractionSet)
```

```{r}
myfiles <- list.files(pattern = 'l1md_decon_chr.*RData')
for (f in myfiles) {
  load(f)
  chro <- before$chrom[1]
  print(
    before %>%
      mutate(l1md_bin = cut_number(l1md_rna/total_rna, 5)) %>%
      filter(!is.na(l1md_bin)) %>%
      ggplot(aes(x = l1md_bin, y = OE)) +
      geom_boxplot(aes(fill = type)) +
      scale_fill_tableau() +
      coord_cartesian(ylim=c(0,2)) +
      geom_hline(yintercept=1, lty='dashed', color='red') +
      theme_classic() +
      ggtitle(paste(chro, 'before')) +
      xlab('L1Md bin')
  )
}
```

## LAD should have more L1 - are the top L1Md ones in LADs?



```{r}
myfiles <- list.files(pattern = 'l1_decon_.*RData')
for (f in myfiles) {
  load(f)
  chro <- after$chrom[1]
  print(
    before %>%
      mutate(l1_bin = cut(l1_rna/total_rna, 5)) %>%
      filter(!is.na(l1_bin)) %>%
      ggplot(aes(x = l1_bin, y = OE)) +
      geom_boxplot(aes(fill = type)) +
      scale_fill_tableau() +
      coord_cartesian(ylim=c(0,2)) +
      geom_hline(yintercept=1, lty='dashed', color='red') +
      theme_classic() +
      ggtitle(paste(chro, 'before')) +
      xlab('L1 bin')
  )
  # print(
  #   after %>%
  #     filter(!is.na(deconvolved)) %>%
  #     mutate(deconvolved_bin = cut_number(deconvolved, 5)) %>%
  #     ggplot(aes(x = deconvolved_bin, y = OE)) +
  #     geom_boxplot(aes(fill=type)) +
  #     geom_hline(yintercept=1, lty='dashed', color='red') +
  #     scale_fill_tableau() +
  #     coord_cartesian(ylim=c(0,2)) +
  #     theme_classic() +
  #     ggtitle(paste(chro, 'after'))
  # )
}
```


```{r}
myfiles <- list.files(pattern = 'b1_decon_.*RData')
for (f in myfiles) {
  load(f)
  chro <- after$chrom[1]
  print(
    before %>%
      mutate(b1_bin = cut_number(b1_rna/total_rna, 5)) %>%
      filter(!is.na(b1_bin)) %>%
      ggplot(aes(x = b1_bin, y = OE)) +
      geom_boxplot(aes(fill = type)) +
      scale_fill_tableau() +
      coord_cartesian(ylim=c(0,2)) +
      geom_hline(yintercept=1, lty='dashed', color='red') +
      theme_classic() +
      ggtitle(paste(chro, 'before')) +
      xlab('B1 bin')
  )
  # print(
  #   after %>%
  #     filter(!is.na(deconvolved)) %>%
  #     mutate(deconvolved_bin = cut_number(deconvolved, 5)) %>%
  #     ggplot(aes(x = deconvolved_bin, y = OE)) +
  #     geom_boxplot(aes(fill=type)) +
  #     geom_hline(yintercept=1, lty='dashed', color='red') +
  #     scale_fill_tableau() +
  #     coord_cartesian(ylim=c(0,2)) +
  #     theme_classic() +
  #     ggtitle(paste(chro, 'after'))
  # )
}
```

DO THE SAME FOR MALAT1, NEAT1, TOP 5 PROTEIN CODING GENES

```{r}
myfiles <- list.files(pattern = 'Malat1_decon_.*RData')
for (f in myfiles) {
  load(f)
  chro <- after$chrom[1]
  print(
    before %>%
      mutate(l1_bin = cut_number(l1_rna/total_rna, 5)) %>%
      filter(!is.na(l1_bin)) %>%
      ggplot(aes(x = l1_bin, y = OE)) +
      geom_boxplot(aes(fill = type)) +
      scale_fill_tableau() +
      coord_cartesian(ylim=c(0,2)) +
      geom_hline(yintercept=1, lty='dashed', color='red') +
      theme_classic() +
      ggtitle(paste(chro, 'before')) +
      xlab('Malat1 bin')
  )
}
```

## are regions with high interactions same with L1, B1, Malat1?

## look at L2

## shorter vs. longer L1Md - stratify by how many 5' ends you get? most will be close to 3'

## get fraction that aligns to first quarter of the element


```{r}
myfiles <- list.files(pattern = 'Neat1_decon_.*RData')
for (f in myfiles) {
  load(f)
  chro <- after$chrom[1]
  print(
    before %>%
      mutate(l1_bin = cut(l1_rna/total_rna, 5)) %>%
      filter(!is.na(l1_bin)) %>%
      ggplot(aes(x = l1_bin, y = OE)) +
      geom_boxplot(aes(fill = type)) +
      scale_fill_tableau() +
      coord_cartesian(ylim=c(0,2)) +
      geom_hline(yintercept=1, lty='dashed', color='red') +
      theme_classic() +
      ggtitle(paste(chro, 'before')) +
      xlab('Neat1 bin')
  )
}
```


```{r}
myfiles <- list.files(pattern = 'Fn1_decon_.*RData')
for (f in myfiles) {
  load(f)
  chro <- after$chrom[1]
  print(
    before %>%
      mutate(l1_bin = cut(l1_rna/total_rna, 5)) %>%
      filter(!is.na(l1_bin)) %>%
      ggplot(aes(x = l1_bin, y = OE)) +
      geom_boxplot(aes(fill = type)) +
      scale_fill_tableau() +
      coord_cartesian(ylim=c(0,2)) +
      geom_hline(yintercept=1, lty='dashed', color='red') +
      theme_classic() +
      ggtitle(paste(chro, 'before')) +
      xlab('Fn1 bin')
  )
}
```


```{r}
myfiles <- list.files(pattern = 'Cnot1_decon_.*RData')
for (f in myfiles) {
  load(f)
  chro <- after$chrom[1]
  print(
    before %>%
      mutate(l1_bin = cut(l1_rna/total_rna, 5)) %>%
      filter(!is.na(l1_bin)) %>%
      ggplot(aes(x = l1_bin, y = OE)) +
      geom_boxplot(aes(fill = type)) +
      scale_fill_tableau() +
      coord_cartesian(ylim=c(0,2)) +
      geom_hline(yintercept=1, lty='dashed', color='red') +
      theme_classic() +
      ggtitle(paste(chro, 'before')) +
      xlab('Cnot1 bin')
  )
}
```



```{r}
myfiles <- list.files(pattern = 'Rpl4_decon_.*RData')
for (f in myfiles) {
  load(f)
  chro <- after$chrom[1]
  print(
    before %>%
      mutate(l1_bin = cut(l1_rna/total_rna, 5)) %>%
      filter(!is.na(l1_bin)) %>%
      ggplot(aes(x = l1_bin, y = OE)) +
      geom_boxplot(aes(fill = type)) +
      scale_fill_tableau() +
      coord_cartesian(ylim=c(0,2)) +
      geom_hline(yintercept=1, lty='dashed', color='red') +
      theme_classic() +
      ggtitle(paste(chro, 'before')) +
      xlab('Rpl4 bin')
  )
}
```

## combine and do coding genes vs. non-coding

## what is fraction of RNA coming from protein coding vs. non-coding




